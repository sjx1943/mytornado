<!--pages/index/index.wxml-->
<view class="container">
  <!-- æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-input-container">
      <input
        class="search-input"
        placeholder="æœç´¢å•†å“"
        value="{{searchValue}}"
        bindinput="onSearchInput"
        bindconfirm="onSearch"
      />
      <view class="search-btn" bindtap="onSearch">
        <text class="iconfont icon-search">ğŸ”</text>
      </view>
    </view>
  </view>

  <!-- åˆ†ç±»å¯¼èˆª -->
  <view class="categories">
    <scroll-view class="categories-scroll" scroll-x="true">
      <view class="category-list">
        <view
          class="category-item"
          wx:for="{{categories}}"
          wx:key="id"
          data-category="{{item}}"
          bindtap="onCategoryTap"
        >
          <view class="category-icon">{{item.icon}}</view>
          <view class="category-name">{{item.name}}</view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- è½®æ’­å›¾ -->
  <view class="banner-section">
    <swiper
      class="banner-swiper"
      indicator-dots="{{true}}"
      autoplay="{{true}}"
      interval="3000"
      duration="500"
    >
      <swiper-item
        wx:for="{{banners}}"
        wx:key="id"
        data-banner="{{item}}"
        bindtap="onBannerTap"
      >
        <image class="banner-image" src="{{item.image}}" mode="aspectFill" />
        <view class="banner-title">{{item.title}}</view>
      </swiper-item>
    </swiper>
  </view>

  <!-- çƒ­é—¨å•†å“ -->
  <view class="section" wx:if="{{hotProducts.length > 0}}">
    <view class="section-header">
      <view class="section-title">ğŸ”¥ çƒ­é—¨å•†å“</view>
      <view class="section-more" bindtap="onMoreHotTap">æ›´å¤š</view>
    </view>
    <view class="hot-products">
      <view class="hot-grid">
        <view
          class="hot-product-item"
          wx:for="{{hotProducts}}"
          wx:key="id"
          data-product="{{item}}"
          bindtap="onProductTap"
        >
          <image class="hot-product-image" src="{{item.image}}" mode="aspectFill" />
          <view class="hot-product-info">
            <view class="hot-product-name">{{item.name}}</view>
            <view class="hot-product-price">Â¥{{item.price}}</view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æœ€æ–°å•†å“ -->
  <view class="section">
    <view class="section-header">
      <view class="section-title">ğŸ†• æœ€æ–°å‘å¸ƒ</view>
      <view class="publish-btn" bindtap="onPublishTap">
        <text class="iconfont">+</text> å‘å¸ƒ
      </view>
    </view>
    
    <view class="product-list" wx:if="{{recentProducts.length > 0}}">
      <view
        class="product-item"
        wx:for="{{recentProducts}}"
        wx:key="id"
        data-product="{{item}}"
        bindtap="onProductTap"
      >
        <image class="product-image" src="{{item.image}}" mode="aspectFill" />
        <view class="product-info">
          <view class="product-name">{{item.name}}</view>
          <view class="product-desc">{{item.description}}</view>
          <view class="product-meta">
            <view class="product-price">Â¥{{item.price}}</view>
            <view class="product-location">{{item.location || 'æœ¬åœ°'}}</view>
          </view>
          <view class="product-tags">
            <view class="tag">{{item.tag}}</view>
            <view class="product-time">{{item.timeAgo}}</view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!loading && recentProducts.length === 0}}">
      <view class="empty-icon">ğŸ“¦</view>
      <view class="empty-text">æš‚æ— å•†å“</view>
      <view class="empty-action">
        <button class="btn btn-primary" bindtap="onPublishTap">å‘å¸ƒç¬¬ä¸€ä¸ªå•†å“</button>
      </view>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading" wx:if="{{loading}}">
      <view class="loading-spinner"></view>
      <view>åŠ è½½ä¸­...</view>
    </view>
  </view>

  <!-- ç”¨æˆ·ä¿¡æ¯æˆæƒ -->
  <view class="auth-section" wx:if="{{!hasUserInfo}}">
    <view class="auth-card">
      <view class="auth-title">å®Œå–„ä¸ªäººä¿¡æ¯</view>
      <view class="auth-desc">è·å–æ‚¨çš„å¤´åƒå’Œæ˜µç§°ï¼Œæä¾›æ›´å¥½çš„æœåŠ¡</view>
      <button
        wx:if="{{canIUseGetUserProfile}}"
        class="btn btn-primary btn-block"
        bindtap="getUserProfile"
      >
        æˆæƒç™»å½•
      </button>
      <button
        wx:else
        class="btn btn-primary btn-block"
        open-type="getUserInfo"
        bindgetuserinfo="getUserInfo"
      >
        æˆæƒç™»å½•
      </button>
    </view>
  </view>
</view>
